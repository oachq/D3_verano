; Timer 2 configuraci√≥n. 

;PROGRAMA QUE MUESTRA POR EL PUERTO D LA PALABRA BYE
;CADA 2 SEGUNDOS, TEMPORIZADO POR EL T2
;Y QUE ESTE INCREMENTANDO EL PUERTO C
;CADA SEGUNDO POR MEDIO DE RETARDO POR SW

; formula   
; tmp_TMR2 = [ prescaler * (PR2+1)* Postcaler ] * Tinstr 
; mp_TMR2 = 65 k


    LIST	P=18F4550
	#INCLUDE	<P18F4550.INC>
	
	CONFIG	FOSC=INTOSCIO_EC
	CONFIG	BOR=OFF	
	CONFIG	CP0=OFF	
	CONFIG	CP1=OFF	
	CONFIG	CPB=OFF	
	CONFIG	DEBUG=OFF	
	CONFIG	LVP=OFF	
	CONFIG	MCLRE=OFF	 
	CONFIG	PBADEN=OFF
	CONFIG	PWRT=ON
	CONFIG	XINST=OFF	
	CONFIG	WDT=OFF	

    CBLOCK	0X20
        CT2
		TEMP
		PCVIRT
		CUENTA
		CUENTA2
		CUENTA3
		FLAG
	ENDC

    ORG		0X0000
	GOTO	INICIO

	ORG		0X0008
	GOTO	ISR_T2

CPORTS
	MOVLW	0FH
	MOVWF	ADCON1
	MOVLW	07H
	MOVWF	CMCON
	MOVLW	62H
	MOVWF	OSCCON
    BCF     TRISB,0 ; puerto B, 0 como salida 
	clrf	TRISD
	clrf	TRISC
	clrf	TRISD
	clrf	LATD
	clrf	LATD
	RETURN

CONFT2
	movlw	0x7B
	MOVWF	T2CON
	bcf		RCON
	bsf		PIE1, TMR2IE
	bsf		INTCON, PEIE
	movlw	.194
	movwf	PR2
	movlw	.40
	movwf	CT2
	bcf		PIR1, TMR2IF
	return 

ISR_T2
	BTFSS	PIR1, TMR2IF
	BRA		FIN
	DECFSZ	CT2, F
	BRA		FIN
	bsf		FLAG, 0
	MOVLW	.40
	movwf	CT2
FIN	BCF PIR1, TMR2IF
	RETFIE

BYE
	RLNCF	TEMP,W
	ADDWF	PCL,F
	DT		B'01111100',B'01100110',B'01111001'

DESPEDIDA
	clrf	TEMP
	rcall	BYE
	INCF	TEMP,F
TNX	movlw	.3
	SUBWF	TEMP,W
	BZ		NEXT
	bra		TNX

INICIO
		RCALL 	CPORTS
		RCALL	CONFT2
		clrf	TEMP
		clrf	PCVIRT
NEXT	BTFSS	FLAG,0
		bra		SALUDO
		INCF	PCVIRT,F
		movff	LATC,PCVIRT
		rcall	RETARDO
		bra		NEXT
	END


