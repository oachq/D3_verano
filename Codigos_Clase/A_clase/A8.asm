; LCD contablas

	LIST	P=18F4550	
	#INCLUDE	<P18F4550.INC>

	CONFIG FOSC=INTOSCIO_EC
	CONFIG PWRT=ON
	CONFIG BOR=OFF
	CONFIG LVP=OFF
	CONFIG MCLRE=OFF
	CONFIG WDT=OFF
	CONFIG DEBUG=OFF
	CONFIG CP0=OFF
	CONFIG CP1=OFF
	CONFIG CPB=OFF
	CONFIG PBADEN=OFF

	#DEFINE	LCD	LATD
	#DEFINE	RS	LATC,4
	#DEFINE	RW	LATC,5
	#DEFINE	E	LATC,6

	CBLOCK	0X20
	TEMP
	MILI
	MILI2
	CNT
	ENDC
	
	ORG	0X0000
	GOTO INICIO
	
	ORG	0X0018
	GOTO INICIO

CPORTS
	MOVLW	0X0F
	MOVWF	ADCON1
	MOVLW	0X07
	MOVWF	CMCON
	MOVLW	0X62
	MOVWF	OSCCON
	CLRF	TRISD
	CLRF	TRISC
	CLRF	LCD
	BCF		RS
	BCF		RW
	BCF		E
	RETURN

CLCD
	MOVLW	0X38
	RCALL	SEND_CMD
	MOVLW	0X0C
	RCALL	SEND_CMD
	MOVLW	0X06
	RCALL	SEND_CMD
	MOVLW	0X01
	RCALL	SEND_CMD
	RETURN

SEND_CMD
	BCF		RS
NEXT	MOVWF	TEMP
	MOVLW	.5
	MOVWF	MILI
	RCALL	RETARDO
	MOVF	TEMP,W
	MOVWF	LCD
	BSF		E
	BCF		E
	RETURN
SEND_CHAR
	BSF		RS
	BRA		NEXT
TABLA
	RLNCF	CNT,W
	ADDWF	PCL,F
	DT		'S','i','s','t',' ','D','i','g'
MENS
	MOVLW	0X80
OT	RCALL	TABLA
	RCALL	SEND_CHAR
	INCF	CNT,F
	MOVF	CNT,W
	SUBLW	.8
	BZ		NEW
	BRA		OT
NEW	MOVLW	0XC0
	RCALL	SEND_CMD
	MOVLW	'3'
	RCALL	SEND_CHAR
	RETURN
RETARDO
	MOVLW	0XF9
	MOVWF	MILI2
	NOP
OT2	DECFSZ	MILI2,F
	BRA		OT2
	DECFSZ	MILI,F
	BRA		RETARDO
	RETURN
INICIO
	RCALL	CPORTS
	RCALL	CLCD
	CLRF	CNT
	RCALL	MENS
	BRA		$
	END