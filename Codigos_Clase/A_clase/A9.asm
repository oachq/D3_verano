; LCD dibujo pacman 

	LIST	P=18F4550
	#INCLUDE	<P18F4550.INC>
	
	CONFIG FOSC=INTOSCIO_EC
	CONFIG PWRT=ON
	CONFIG BOR=OFF
	CONFIG LVP=OFF
	CONFIG MCLRE=OFF
	CONFIG WDT=OFF
	CONFIG DEBUG=OFF
	CONFIG CP0=OFF
	CONFIG CP1=OFF
	CONFIG CPB=OFF
	CONFIG PBADEN=OFF
	#DEFINE	LCD	LATD
	#DEFINE	RS	LATC,4
	#DEFINE	RW	LATC,5
	#DEFINE	E	LATC,6

	CBLOCK	0X20
	TEMP
	MILI
	MILI2
	CNT
	ENDC
	
	ORG	0X0000
	GOTO INICIO
	
	ORG	0X0018
	GOTO INICIO

CPORTS
	MOVLW	0X0F
	MOVWF	ADCON1
	MOVLW	0X07
	MOVWF	CMCON
	MOVLW	0X62
	MOVWF	OSCCON
	CLRF	TRISD
	CLRF	TRISC
	CLRF	LCD
	BCF		RS
	BCF		RW
	BCF		E
	RETURN

CLCD
	MOVLW	0X38
	RCALL	SEND_CMD
	MOVLW	0X0C
	RCALL	SEND_CMD
	MOVLW	0X06
	RCALL	SEND_CMD
	MOVLW	0X01
	RCALL	SEND_CMD
	RETURN

SEND_CMD
	BCF		RS
NEXT	MOVWF	TEMP
	MOVLW	.5
	MOVWF	MILI
	RCALL	RETARDO
	MOVF	TEMP,W
	MOVWF	LCD
	BSF		E
	BCF		E
	RETURN
SEND_CHAR
	BSF		RS
	BRA		NEXT

FANTA	;FANTASMA
		RLNCF	CNT,W
		ADDWF	PCL,F
		DT		.14,.31,.21,.31,.17,.31,.21,.0		;FANTASMA
FANTADIR	;FANTASMA DIR
		RLNCF	CNT,W
		ADDWF	PCL,F
		DT		0X40,0X41,0X42,0X43,0X44,0X45,0X46,0X47
PAC		;PACMAN
		RLNCF	CNT,W
		ADDWF	PCL,F
		DT		.14,.31,.22,.28,.24,.31,.14,.0
PACDIR	RLNCF	CNT,W	;PACMAN DIR
		ADDWF	PCL,F
		DT		0X48,0X49,0X4A,0X4B,0X4C,0X4D,0X4E,0X4F

GUARDA
		RCALL	FANTADIR
		RCALL	SEND_CMD
		
		RCALL	FANTA
		RCALL	SEND_CHAR

		RCALL	PACDIR
		RCALL	SEND_CMD
		
		RCALL	PAC
		RCALL	SEND_CHAR

		INCF	CNT,F
		MOVF	CNT,W
		SUBLW	.8
		BZ		FIN
		BRA		GUARDA
FIN		RETURN

MENS
		MOVLW	0X80
		RCALL	SEND_CMD
		MOVLW	.0
		RCALL	SEND_CHAR
		MOVLW	.1
		RCALL	SEND_CHAR
		RETURN

RETARDO
	MOVLW	0XF9
	MOVWF	MILI2
	NOP
OT2	DECFSZ	MILI2,F
	BRA		OT2
	DECFSZ	MILI,F
	BRA		RETARDO
	RETURN
INICIO
	RCALL	CPORTS
	RCALL	CLCD
	RCALL	CNT
	RCALL	GUARDA
	RCALL	MENS
	BRA		$
	END