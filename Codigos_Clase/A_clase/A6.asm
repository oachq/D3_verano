;TECLADO MATRICIAL	4x4 con salida display por el puerto D y teclado en port B

	LIST	P=18F4550
	#INCLUDE	<P18F4550.INC>
	
	CONFIG	FOSC	=	INTOSCIO_EC
	CONFIG	LVP		=	OFF
	CONFIG	MCLRE	=	OFF
	CONFIG	DEBUG	=	OFF
	CONFIG	XINST	=	OFF
	CONFIG	PBADEN	=	OFF
	CONFIG	CP0		=	OFF
	CONFIG	CP1		=	OFF
	CONFIG	CPB		=	OFF
	CONFIG	BOR		=	OFF
	CONFIG 	WDT		=	OFF
	CONFIG	PWRT	=	ON
	
	CBLOCK	0X20
	TECLA
	ENDC
	
	ORG		0X0000
	GOTO	INICIO
	
	ORG		0X0018
	GOTO	INICIO
	
CPORTS
	MOVLW	0X0F
	MOVWF	ADCON1
	MOVLW	0X07
	MOVWF	CMCON
	MOVLW	0X62
	MOVWF	OSCCON
	MOVLW	0XF0
	MOVWF	TRISB
	CLRF	TRISD
	CLRF	LATB
	CLRF	LATD
	RETURN
	
ANTIR		;ANTIRREBOTE

		BTFSC	PORTB,4		;C1
		BRA		ANTIR
SIG		BTFSC	PORTB,5		;C2
		BRA		SIG
SIG2	BTFSC	PORTB,6		;C3
		BRA		SIG2
SIG3	BTFSC	PORTB,7		;C4
		BRA		SIG3	
		RCALL	DECODE
		MOVWF	LATD
		BRA		NEW
		
DECODE	
	RLNCF	TECLA,W
	ADDWF	PCL,F
	RETLW	B'00111111'	;0
	RETLW	B'00000110'	;1
	RETLW	B'01011011'	;2
	RETLW	B'01001111'	;3
	RETLW	B'01100110'	;4
	RETLW	B'01101101'	;5
	RETLW	B'01111101'	;6
	RETLW	B'00000111'	;7
	RETLW	B'01111111'	;8
	RETLW	B'01101111'	;9
	RETLW	B'01110111'	;10-A
	RETLW	B'01111100'	;11-B
	RETLW	B'00111001'	;12-C
	RETLW	B'01011110'	;13-D
	RETLW	B'01111001'	;14-E
	RETLW	B'01110001'	;15-F
	
INICIO
	RCALL	CPORTS
NEW	MOVLW	0X01
	MOVWF	LATB
	CLRF	TECLA
CHK	BTFSC	PORTB,4
	BRA		ANTIR
	INCF	TECLA,F	
	BTFSC	PORTB,5
	BRA		ANTIR
	INCF	TECLA,F
	BTFSC	PORTB,6
	BRA		ANTIR
	INCF	TECLA,F	
	BTFSC	PORTB,7
	BRA		ANTIR
	INCF	TECLA,F
	MOVLW	.16
	SUBWF	TECLA,W
	BTFSC	STATUS,Z
	BRA		NEW
	BCF		STATUS,C
	RLCF	LATB,F
	BRA		CHK
	END
